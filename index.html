<!DOCTYPE HTML>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>Worker example: One-core computation</title>
 </head>
 <body>
 <button type="button" onclick="changeBkColor()">Change Color</button>
 <button type="button" onclick="startCP()">Start Window CP</button>
 <button type="button" onclick="stopCP()">Stop Window CP</button>

  <h2> Dedicated worker is started at page launch</h2>
  <p> ------------------------------------------------------------------------------------------- </p>
  <p>Current CP state from observer in Window is: <output id="CPWState"></output></p>
  <p> ------------------------------------------------------------------------------------------- </p>
  <p>Current CP state from observer in dedicated worker is: <output id="CPDWState"></output></p>
  <p>Current CP timestamp from obserser in dedicated worker is: <output id="CPDWTimestamp"></output></p>
  <p>Current CP source from observer in dedicated worker is: <output id="CPDWSource"></output></p>
  <p> ------------------------------------------------------------------------------------------- </p>
  <p>Current CP state from observer in shared worker is: <output id="CPSWState"></output></p>
  <p>Current CP timestamp from obserser in shared worker is: <output id="CPSWTimestamp"></output></p>
  <p>Current CP source from observer in shared worker is: <output id="CPSWSource"></output></p>


  <script>
  document.body.style.backgroundColor= "LightCoral";
  var isCoral = 1;
  function changeBkColor()
  {
    if (isCoral) {
     document.body.style.backgroundColor= "DarkSeaGreen";
     isCoral = 0;
    } else {
     document.body.style.backgroundColor= "LightCoral";
     isCoral = 1;
    }


  }

  function pressureCallbackX(update) {
      console.log("cpuState X = " + update[0].state);
      console.log("cpu factor X = " + update[0].factors[0]);
    if (update[0].factors[1])
      console.log("cpu factor X = " + update[0].factors[1]);
      console.log("timestamp = " + update[0].time);
     document.getElementById("CPWState").textContent = update[0].state;
  };

  observerX = new PressureObserver(pressureCallbackX, {sampleRate : 0.5});


  function startCP()
  {
    observerX.observe("cpu");
  }

  function stopCP()
  {
    observerX.unobserve("cpu");
    document.getElementById("CPWState").textContent = "";
  }

//  var myDedicatedWorker = new Worker('d_worker.mjs', { type: "module"});
  var myDedicatedWorker = new Worker('d_worker.js');
  myDedicatedWorker.onmessage = function (event) {
    document.getElementById("CPDWState").textContent = event.data.state;
    document.getElementById("CPDWTimestamp").textContent = event.data.time;
    document.getElementById("CPDWSource").textContent = event.data.source;
    document.getElementById("CPDWFactors").textContent = event.data.factors;
    console.log(typeof event.data + " NONO");
  };
/*
  var mySharedWorker = new SharedWorker('s_worker.js', { type: "module"});
  worker.onmessage = function (event) {
    document.getElementById("CPDWState").textContent = event.data.state;
    document.getElementById("CPDWTimestamp").textContent = event.data.time;
    document.getElementById("CPDWSource").textContent = event.data.source;
    document.getElementById("CPDWFactors").textContent = event.data.factors;
    console.log(typeof event.data + " NONO");
  };
*/

  </script>
 </body>
</html>
